{"version":3,"file":"appTalkingAio.js","sources":["../../../../packages/appTalking/appTalkingAio.ts"],"sourcesContent":["import { Logger } from '@gtLibTs/logger';\nimport { DetectDevice } from '@gtLibTs/utils/detectDevice';\n\nimport { AppTalkingBase } from './appTalkingBase';\n\ntype IOSCallback = (...args: any) => void;\n\nexport class AppTalkingAio extends AppTalkingBase {\n    private nativeBridge;\n\n    constructor() {\n        super();\n\n        this.nativeBridge = {\n            callbacksCount: 1,\n            callbacks: {} as { [key: string]: IOSCallback },\n            resultForCallback(callbackId: number, resultArray: any[]) {\n                try {\n                    this.callbacks[callbackId]?.apply(null, resultArray);\n                } catch (e) {\n                    alert(e);\n                }\n            },\n            call(functionName: string, args: any[], callback?: IOSCallback) {\n                let callbackId = 0;\n\n                if (callback) {\n                    callbackId = this.callbacksCount++;\n                    this.callbacks[callbackId] = callback;\n                }\n\n                let iframe: HTMLIFrameElement | null = document.createElement('iframe');\n                iframe.setAttribute('src', `js-frame:${functionName}:${callbackId}:${encodeURIComponent(JSON.stringify(args))}`);\n                document.documentElement.appendChild(iframe);\n                iframe.parentNode?.removeChild(iframe);\n                iframe = null;\n            }\n        };\n    }\n\n    private iosAppToJsMessage(...args: any) {\n        Logger.log('iosAppToJsMessage', ...args);\n    }\n\n    // private androidAppToJsMessage(message: string) {\n    //     Logger.log('androidAppToJsMessage', message);\n    // }\n\n    private iosJsToAppMessage(message: string) {\n        this.nativeBridge.call('JsToAppMessage', [message], this.iosAppToJsMessage);\n    }\n\n    private androidJsToAppMessage(message: string) {\n        (window as any).MyHandler?.JsToAppMessage?.(message);\n    }\n\n    private jsToAppMessage(message: string) {\n        if (DetectDevice.isAIO) {\n            if (DetectDevice.iOS) {\n                this.iosJsToAppMessage(message);\n            } else if (DetectDevice.Android) {\n                this.androidJsToAppMessage(message);\n            }\n        }\n    }\n\n    // when game loaded remove exit btn\n    public onLoaded() {\n        this.jsToAppMessage('{ event : \"LOADED\", \"data\":\"\" }');\n    }\n\n    public leaveGame(logout?: boolean) {\n        if (logout) {\n            this.jsToAppMessage('{\"event\":\"SESSION_INVALIDATE\", \"data\":\"\"}');\n            return;\n        }\n\n        this.jsToAppMessage('{\"event\":\"EXIT\", \"data\":\"\"}');\n    }\n\n    public open_hall() {\n        const url = `${location.protocol.includes('https') ? 'https' : 'http'}://${location.hostname}`;\n        this.jsToAppMessage(`{\"event\":\"NEW_WEBVIEW_ON_TOP\",\"data\":\"${url}/m/app#pageSport\"}`);\n    }\n\n    public startApp(app: string) {\n        this.jsToAppMessage(`{\"event\":\"START_APP\",\"data\":\"${app}\"}`);\n    }\n\n    public checkAppStatus(apps: any) {\n        this.jsToAppMessage(`{\"event\":\"CHECK_APP\",\"data\":${JSON.stringify(apps)}}`);\n    }\n\n    public closeWebView() {\n        this.jsToAppMessage('{\"event\":\"CLOSE_WEBVIEW_ON_TOP\", \"data\":\"\"}');\n    }\n\n    public startBrowser(root: string) {\n        const url = `${location.protocol.includes('https') ? 'https' : 'http'}://${location.hostname}`;\n\n        this.jsToAppMessage(`{\"event\":\"START_BROWSER\",\"data\":\"${url}${root}\"}`);\n    }\n\n    public closePayOnline() {\n        this.jsToAppMessage('{\"event\":\"CLOSE_WINDOW\", \"data\":\"\"}');\n    }\n\n    public registerSuccess() {\n        this.jsToAppMessage('{\"event\":\"REGISTER_SUCCESS\", \"data\":\"\"}');\n    }\n\n    public accountSuspended() {\n        this.jsToAppMessage('{\"event\":\"ACCOUNT_SUSPENDED\", \"data\":\"\"}');\n    }\n\n    public maintaining() {\n        this.jsToAppMessage('{\"event\":\"MAINTAINING\", \"data\":\"\"}');\n    }\n\n    public notOpen() {\n        this.jsToAppMessage('{\"event\":\"NOT_OPEN\", \"data\":\"\"}');\n    }\n\n    public bound() {\n        this.jsToAppMessage('{\"event\":\"BOUND\", \"data\":\"\"}');\n    }\n\n    public signIn() {\n        this.jsToAppMessage('{\"event\":\"SIGNIN\", \"data\":\"\"}');\n    }\n\n    public showWebGLNoSupport() {\n        this.jsToAppMessage('{\"event\":\"EVENT_WEBGL_NOTSUPPORT\", \"data\":\"\"}');\n    }\n}"],"names":["AppTalkingBase","Logger","DetectDevice"],"mappings":"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"}